{% extends "base.html" %}
{% block content %}

<h2>SQL-звіти</h2>

<form method="post" class="card card-body shadow-sm mb-4">
    <label class="form-label">Оберіть звіт:</label>
    <select class="form-select" name="query_id">
        <option value="1">1. Графік роботи спеціальних служб</option>
        <option value="2">2. Абоненти з заявками на зміну номера</option>
        <option value="3">3. Ремонтні роботи</option>
        <option value="4">4. Номери спеціальних служб</option>
        <option value="5">5. Абоненти за ПІБ</option>
        <option value="6">6. Абоненти за операторами</option>
        <option value="7">7. Абоненти з боргами</option>
        <option value="8">8. Абоненти, які змінили адресу та номер</option>
        <option value="9">9. Абоненти за вулицею</option>
        <option value="10">10. Вулиці з найбільшою кількістю абонентів</option>
    </select>

    {% if selected == "5" %}
        <div class="row mt-3">
            <div class="col">
                <input class="form-control" name="lastname" placeholder="Прізвище">
            </div>
            <div class="col">
                <input class="form-control" name="firstname" placeholder="Ім’я">
            </div>
        </div>
    {% endif %}

    {% if selected == "9" %}
    <div class="mt-3">
        <label class="form-label">Вулиця:</label>
        <input class="form-control" name="street_name" placeholder="Наприклад: Шевченка">
    </div>
    {% endif %}

    <button class="btn btn-primary mt-3">Виконати</button>
</form>

{% if result %}
<div class="card card-body shadow-sm mt-4">
    <h4 class="mb-3">Результати:</h4>

    {# --- Для запитів 5 і 9 є (rows, count) --- #}
    {% if selected in ["5", "9"] %}
        {% set rows = result[0] %}
        {% set cnt = result[1] %}

        <p><strong>Загальна кількість:</strong> {{ cnt }}</p>
    {% else %}
        {% set rows = result %}
        {% set cnt = None %}
    {% endif %}

    {% if rows and rows|length > 0 %}
        <table class="table table-bordered table-striped table-sm">
            <thead>
                <tr>
                    {% for col in rows[0].keys() %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    {% for col in row.keys() %}
                        <td>{{ row[col] }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Немає даних.</p>
    {% endif %}
</div>
{% endif %}


{% endblock %}
